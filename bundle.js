(()=>{"use strict";var e,t={562:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(445)),o=a(n(690)),r=a(n(807)),c=a(n(934)),i=a(n(910)),d=a(n(187));class l{static updatingCar;static create(){l.make(),l.update(),l.generate(),l.race(),l.reset(),l.nextPrew(),l.pagination(r.default.sessions.pagWin,r.default.sessions.pagTime,".winListHeaderCount"),l.pagination(r.default.sessions.pagTime,r.default.sessions.pagWin,".winListHeaderTime")}static make(){document.querySelector(".btnTopCont")?.addEventListener("click",(()=>{o.default.create(),o.default.updateGaragePage()}))}static update(){document.querySelector(".btnMiddleCont")?.addEventListener("click",(()=>{s.default.updateCar(),o.default.updateGaragePage()}))}static generate(){document.querySelector(".genCarsBtn")?.addEventListener("click",(()=>{o.default.generateCars(),o.default.updateGaragePage()}))}static race(){document.querySelector(".raceBtn")?.addEventListener("click",(()=>{const e=document.querySelector(".messCont");e&&e.parentNode?.removeChild(e);let t=0;t=0!==c.default.count&&c.default.count<7?c.default.count:7,!1===o.default.isRace&&o.default.countRace===t?(o.default.updateGaragePage(),o.default.countRace=0,o.default.isWin=!1,o.default.startRace("started")):l.showMessage()}))}static showMessage(){i.default.maintenance(),document.querySelector(".btnOk")?.addEventListener("click",(()=>{const e=document.querySelector(".field");e?.parentNode?.removeChild(e),o.default.isWin=!1}))}static reset(){document.querySelector(".resetBtn")?.addEventListener("click",(()=>{!1===o.default.isRace?(o.default.updateGaragePage(),o.default.startRace("stopped")):l.showMessage()}))}static prew(e,t){Number(sessionStorage.getItem(e))>0&&sessionStorage.setItem(e,JSON.stringify(Number(sessionStorage.getItem(e))-1));const n=document.querySelector(t);n&&(n.textContent=`page #${Number(sessionStorage.getItem(e))+1}`),o.default.updateGaragePage()}static next(e,t,n){s.default.getAllCar().then((a=>{Math.ceil(a.length/n)>Number(sessionStorage.getItem(e))+1&&sessionStorage.setItem("page",JSON.stringify(Number(sessionStorage.getItem(e))+1));const s=document.querySelector(t);s&&(s.textContent=`page #${Number(sessionStorage.getItem(e))+1}`)})),o.default.updateGaragePage()}static nextPrew(){document.querySelector(".prew")?.addEventListener("click",(()=>{l.prew(r.default.sessions.garPage,".pageNum")})),document.querySelector(".next")?.addEventListener("click",(()=>{l.next(r.default.sessions.garPage,".pageNum",7)})),document.querySelector(".winPrew")?.addEventListener("click",(()=>{l.prew(r.default.sessions.winPage,".winPageNum")})),document.querySelector(".winNext")?.addEventListener("click",(()=>{l.next(r.default.sessions.winPage,".winPageNum",10)}))}static pagination(e,t,n){document.querySelector(n)?.addEventListener("click",(()=>{sessionStorage.setItem(t,r.default.sorted.none),sessionStorage.getItem(e)===r.default.sorted.none?(sessionStorage.setItem(e,r.default.sorted.up),d.default.winsSort=sessionStorage.getItem(e)):sessionStorage.getItem(e)===r.default.sorted.up?sessionStorage.setItem(e,r.default.sorted.down):sessionStorage.getItem(e)===r.default.sorted.down&&sessionStorage.setItem(e,r.default.sorted.none),o.default.updateGaragePage()}))}}t.default=l},445:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(562)),o=a(n(690));class r{static baseUrl="http://127.0.0.1:3000";static path={garage:"/garage",winners:"/winners",engine:"/engine"};static async runStop(e,t){const n=await fetch(`${r.baseUrl}${r.path.engine}?id=${e}&status=${t}`,{method:"PATCH"});return await n.json()}static async driveStatus(e,t){return(await fetch(`${r.baseUrl}${r.path.engine}?id=${e}&status=${t}`,{method:"PATCH"})).status}static async createCar(e){return(await fetch(`${r.baseUrl}${r.path.garage}`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)})).json()}static async updateCar(){const e=document.querySelector(".inputMiddleCont"),t=document.querySelector(".colorMiddleCont"),n={id:s.default.updatingCar.id,name:e.value,color:t.value};return(await fetch(`${r.baseUrl}${r.path.garage}/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)})).json()}static async updateWin(e,t){return(await fetch(`${r.baseUrl}${r.path.winners}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}static async getAllCar(){const e=await fetch(`${r.baseUrl}${r.path.garage}`);return await e.json()}static async deleteCar(e){const t=await fetch(`${r.baseUrl}${r.path.garage}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json; charset=utf-8"}});return r.deleteWin(e),o.default.updateGaragePage(),t.json()}static async deleteWin(e){return(await fetch(`${r.baseUrl}${r.path.winners}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json; charset=utf-8"}})).json()}static async getAllWinners(){const e=await fetch(`${r.baseUrl}${r.path.winners}`);return await e.json()}static async getCar(e){const t=await fetch(`${r.baseUrl}${r.path.garage}/${e}`);return await t.json()}static async getWin(e){const t=await fetch(`${r.baseUrl}${r.path.winners}/${e}`);return await t.json()}static async createWinner(e){return(await fetch(`${r.baseUrl}${r.path.winners}`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)})).json()}}t.default=r},690:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(562)),o=a(n(807)),r=a(n(934)),c=a(n(910)),i=a(n(445));class d{static namesArray=["Tesla","BMW","Mercedes","Ford","Opel","Volkswagen","Telega","Audi","Skoda","Yaguar","Lamborghini","Rolls-Royce","Nissan","Hyundai","Mazda","Mitsubishi","Honda","Toyota"];static secondArray=["Model Y","X7","W233","Mustang","Insignia","Passat","RS7","Fabia","X-Type","Huracan","Phantom","Patrol","Elantra","Miata","Lancer","Accord","Prius"];static garagePage=new r.default("garage");static isRace=!1;static isWin=!1;static countRace=7;static updateGaragePage(){(new o.default).run()}static create(){const e=document.querySelector(".inputTopCont"),t=document.querySelector(".colorTopCont"),n={id:null,name:`${e.value}`,color:`${t.value}`};i.default.createCar(n)}static createWin(e,t){const n={id:e,time:t,wins:1};i.default.getWin(e).then((a=>{if(void 0!==a.id){const n={time:t,wins:a.wins+1};a.time<t&&(n.time=a.time),i.default.updateWin(e,n)}else i.default.createWinner(n)}))}static update(e){const t=document.querySelector(".inputMiddleCont"),n=document.querySelector(".colorMiddleCont");t.value=e.name,n.value=e.color,s.default.updatingCar=e}static generateColor(){let e=`${Math.floor(256*Math.random()).toString(16)}`;1===e.length&&(e=`0${e}`);let t=`${Math.floor(256*Math.random()).toString(16)}`;1===t.length&&(t=`0${t}`);let n=`${Math.floor(256*Math.random()).toString(16)}`;return 1===n.length&&(n=`0${n}`),`#${e}${t}${n}`}static generateCars(){for(let e=0;e<100;e+=1){const e={id:null,name:`${this.namesArray[Math.floor(Math.random()*this.namesArray.length)]} ${this.secondArray[Math.floor(Math.random()*this.secondArray.length)]}`,color:`${this.generateColor()}`};i.default.createCar(e)}this.garagePage.render()}static runAnim(e,t,n){if(d.isRace&&"B"===n)return;const a=document.getElementById(`btnB${e}`),s=document.getElementById(`btnA${e}`);"A"===n&&s?.classList.contains("disactiveBtn")||"B"===n&&a?.classList.contains("disactiveBtn")||("stopped"!==t||a?.classList.contains("disactiveBtn")||(a?.classList.add("disactiveBtn"),s?.classList.remove("disactiveBtn")),"started"!==t||s?.classList.contains("disactiveBtn")||(s?.classList.add("disactiveBtn"),a?.classList.remove("disactiveBtn")),i.default.runStop(e,t).then((t=>{d.anim(t.velocity,t.distance,e)})))}static anim(e,t,n){const a=i.default.driveStatus(n,"drive"),s=document.getElementById(`car${n}`);0===e&&(s.style.left="3000px");const o=window.innerWidth,r=o/t*7*e;let c=0,l=0;const u=Date.now(),m=requestAnimationFrame((function e(){if(console.log(d.isRace,d.countRace),c<o-265&&500!==l&&404!==l&&"3000px"!==s.style.left&&window.requestAnimationFrame(e),500===l&&!0===d.isRace&&(d.countRace+=1),c>o-265){!0===d.isRace&&(d.countRace+=1),7===d.countRace&&(d.isRace=!1);const e=Math.floor((Date.now()-u)/10)/100;!0===d.isRace&&!1===d.isWin&&(d.showWinMessage(n,e),d.isWin=!0)}s.style.left=`${c+=r}px`}));a.then((e=>{404===e&&cancelAnimationFrame(m),l=e}))}static showWinMessage(e,t){let n;i.default.getCar(e).then((a=>{n=a.name,document.querySelector("#garage")?.append(c.default.winnerMessage(n,t)),d.createWin(e,t)}))}static startRace(e){"stopped"!==e&&(d.isRace=!0),i.default.getAllCar().then((t=>{t.forEach(((t,n)=>{const a=Number(sessionStorage.getItem(o.default.sessions.garPage));n>=7*a&&n<7*(a+1)&&t.id&&d.runAnim(t.id,e,"none")}))}))}}t.default=d},910:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(807));t.default=class{static winnerMessage(e,t){const n=document.createElement("div");return n.className="messCont",n.textContent=`${e} went first [${t}sec] !`,n}static maintenance(){const e=document.createElement("div");e.className="field";const t=document.createElement("div");t.className="window",t.textContent="Sorry, but the cars you have chosen haven't yet reached the end of the track or are being serviced. You can wait or choose cars from another garage";const n=document.createElement("div");n.className="btnOk btnOne",n.textContent="OK",t.append(n),e.append(t),s.default.bodyContainer.append(e)}}},807:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(562)),o=a(n(192)),r=a(n(934)),c=a(n(187)),i=a(n(323));class d{static bodyContainer=document.body;static defaultPageId="current-page";static sessions={garPage:"page",winPage:"wPage",pagWin:"sortWins",pagTime:"sortTime"};static sorted={none:"none",up:"up",down:"down"};header;static renderNewPage(e){const t=document.getElementById("garage"),n=document.getElementById("winners"),a=document.getElementById("error");"garage"===e||""===e?(t&&(t.style.display="block"),n&&(n.style.display="none"),a&&(a.style.display="none")):"winners"===e?(t&&(t.style.display="none"),n&&(n.style.display="block"),a&&(a.style.display="none")):(t&&(t.style.display="none"),n&&(n.style.display="none"),a&&(a.style.display="block")),s.default.create()}static enableRouteChange(){window.addEventListener("hashchange",(()=>{const e=window.location.hash.slice(1);d.renderNewPage(e)}))}constructor(){this.header=new i.default("header","headerButton")}run(){sessionStorage.getItem(d.sessions.garPage)||sessionStorage.setItem(d.sessions.garPage,JSON.stringify(0)),sessionStorage.getItem(d.sessions.winPage)||sessionStorage.setItem(d.sessions.winPage,JSON.stringify(0)),sessionStorage.getItem(d.sessions.pagWin)||sessionStorage.setItem(d.sessions.pagWin,d.sorted.none),sessionStorage.getItem(d.sessions.pagTime)||sessionStorage.setItem(d.sessions.pagTime,d.sorted.none),d.bodyContainer.replaceChildren(),d.bodyContainer.append(this.header.render());const e=new r.default("garage"),t=new c.default("winners"),n=new o.default("",404).render();n.id="error",n.style.display="none";const a=e.render();a.id="garage";const s=t.render();s.id="winners",s.style.display="none",d.bodyContainer.append(a,s,n);const i=window.location.hash.slice(1);d.renderNewPage(i),d.enableRouteChange()}}t.default=d},192:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(879));class o extends s.default{errorType;static TextObject={404:"Error! The page was not found."};constructor(e,t){super(e),this.errorType=t}static createHeaderTitle(e){const t=document.createElement("h1");return t.textContent=e,t}render(){const e=o.createHeaderTitle(o.TextObject[this.errorType]);return this.container.append(e),this.container}}t.default=o},934:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(445)),o=a(n(879)),r=a(n(690)),c=a(n(807));class i extends o.default{static count;static createHeaderTitle(e){const t=document.createElement("h1");return t.textContent=`${e}`,t.className="titlePage garageTitle",t}static createTopChangeCont(){const e=document.createElement("div");e.className="topCont conts";const t=document.createElement("input");t.className="inputTopCont inputChange";const n=document.createElement("input");n.type="color",n.className="colorTopCont colorChange";const a=document.createElement("div");return a.className="btnTopCont btnChange btnOne",a.textContent="CREATE",e.append(t,n,a),e}static createMiddleChangeCont(){const e=document.createElement("div");e.className="middleCont conts";const t=document.createElement("input");t.className="inputMiddleCont inputChange";const n=document.createElement("input");n.type="color",n.className="colorMiddleCont colorChange";const a=document.createElement("div");return a.className="btnMiddleCont btnChange btnOne",a.textContent="UPDATE",e.append(t,n,a),e}static createBottomChangeCont(){const e=document.createElement("div");e.className="bottomCont conts";const t=document.createElement("div");t.className="raceBtn btnOne",t.textContent="RACE";const n=document.createElement("div");n.className="resetBtn btnOne",n.textContent="RESET";const a=document.createElement("div");return a.className="genCarsBtn btnOne",a.textContent="GENERATE CARS",e.append(t,n,a),e}static createChangeContainer(){const e=document.createElement("div");e.className="changeContainer";const t=i.createTopChangeCont(),n=i.createMiddleChangeCont(),a=i.createBottomChangeCont();return e.append(t,n,a),e}static createButtonBlock(e){const t=document.createElement("div");t.className="btnBlock";const n=document.createElement("div");n.className="selectBtn btnOne btn",n.textContent="SELECT",n.addEventListener("click",(()=>{r.default.update(e)}));const a=document.createElement("div");a.className="removeBtn btnOne btn",a.textContent="REMOVE",a.addEventListener("click",(()=>{e.id&&s.default.deleteCar(e.id)}));const o=document.createElement("p");return o.className="nameCar",o.textContent=e.name,t.append(n,a,o),t}static createBottomBlock(e){const t=document.createElement("div");t.className="bottomBlock";const n=document.createElement("div");n.className="btnA letter activeBtn",n.textContent="A",n.id=`btnA${e.id}`,n.addEventListener("click",(()=>{e.id&&r.default.runAnim(e.id,"started","A")}));const a=document.createElement("div");a.className="btnB letter disactiveBtn",a.textContent="B",a.id=`btnB${e.id}`,a.addEventListener("click",(()=>{e.id&&r.default.runAnim(e.id,"stopped","B")}));const s=document.createElement("div");s.className="car",s.id=`car${e.id}`,s.style.backgroundColor=`${e.color}`,s.style.webkitMaskImage=`url("https://raw.githubusercontent.com/Sedric14/assets/main/race/car${Math.floor(6*Math.random()+1)}.png")`;const o=document.createElement("div");return o.className="flag",t.append(n,a,s,o),t}static createCarBlock(e){const t=document.createElement("div");t.className="carBlock";const n=i.createButtonBlock(e),a=i.createBottomBlock(e);return t.append(n,a),t}static createPrewNext(){const e=document.createElement("div");e.className="prewNextBlock";const t=document.createElement("div"),n=document.createElement("div");return t.className="prew prewNext btnOne",n.className="next prewNext btnOne",t.textContent="<<<",n.textContent=">>>",e.append(t,n),e}static createCarsList(){const e=document.createElement("div");return e.className="carBlockContainer",s.default.getAllCar().then((t=>{const n=t.length;i.count=n;const a=document.querySelector(".garageTitle");a&&(a.textContent=`GARAGE (${n})`),t.forEach(((t,n)=>{const a=Number(sessionStorage.getItem(c.default.sessions.garPage));n>=7*a&&n<7*(a+1)&&e.append(i.createCarBlock(t))}))})),e}static createPageNum(){const e=document.createElement("p");return e.className="pageNum",e.textContent=`page #${Number(sessionStorage.getItem(c.default.sessions.garPage))+1}`,e}render(){const e=i.createCarsList(),t=i.createPageNum(),n=i.createHeaderTitle("GARAGE"),a=i.createChangeContainer(),s=i.createPrewNext();return this.container.append(a,n,t,e,s),this.container}}t.default=i},323:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=[{id:"garage",text:"GARAGE"},{id:"winners",text:"WINNERS"}];t.default=class{container;constructor(e,t){this.container=document.createElement(e),this.container.className=t}renderPageButtons(){const e=document.createElement("div");e.className="headerBtnContainer",n.forEach((t=>{const n=document.createElement("a");n.className="headerBtn btnOne",n.href=`#${t.id}`,n.innerText=t.text,e.append(n)})),this.container.append(e)}render(){return this.renderPageButtons(),this.container}}},879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{container;static TextObject={};constructor(e){this.container=document.createElement("div"),this.container.id=e}static createHeaderTitle(e){const t=document.createElement("h1");return t.innerText=e,t}render(){return this.container}}},187:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=a(n(445)),o=a(n(807)),r=a(n(879));class c extends r.default{static winsSort=sessionStorage.getItem("sortWins");static timeSort=sessionStorage.getItem("sortTime");static createHeaderTitle(e){const t=document.createElement("h1");return t.className="titlePage winnersTitle",t.textContent=e,t}static createWinnerBlock(e,t){const n=document.createElement("div");n.className="winnerBlock";const a=document.createElement("p");a.className="winNum",a.textContent=`${t+1}`;const o=document.createElement("div");o.className="winImage";const r=document.createElement("p");r.className="winName";const c=document.createElement("p");c.className="winCount",c.textContent=`${e.wins}`;const i=document.createElement("p");return i.className="winTime",i.textContent=`${e.time}`,s.default.getCar(e.id).then((e=>{o.style.backgroundColor=`${e.color}`,r.textContent=`${e.name}`})),n.append(a,o,r,c,i),n}static createListHeader(){const e=document.createElement("div");e.className="winListHeader";const t=document.createElement("div");t.className="winListHeaderNum btnOne",t.textContent="№";const n=document.createElement("div");n.className="winListHeaderImage btnOne",n.textContent="CAR";const a=document.createElement("div");a.className="winListHeaderName btnOne",a.textContent="NAME";const s=document.createElement("div");s.className="winListHeaderCount btnOne",s.textContent="WINS";const o=document.createElement("div");return o.className="winListHeaderTime btnOne",o.textContent="BEST TIME",e.append(t,n,a,s,o),e}static createPrewNext(){const e=document.createElement("div");e.className="winPrewNextBlock";const t=document.createElement("div"),n=document.createElement("div");return t.className="winPrew prewNext btnOne",n.className="winNext prewNext btnOne",t.textContent="<<<",n.textContent=">>>",e.append(t,n),e}render(){const e=Number(sessionStorage.getItem(o.default.sessions.winPage)),t=document.createElement("div");t.className="winListContainer",t.append(c.createListHeader()),s.default.getAllWinners().then((n=>{const a=document.querySelector(".winListHeaderCount"),s=document.querySelector(".winListHeaderTime"),r=n.length,i=document.querySelector(".winnersTitle");let d;i&&(i.textContent=`WINNERS (${r})`),sessionStorage.getItem("sortWins")===o.default.sorted.up?(a&&(a.textContent="WINS ↑"),d=n.sort(((e,t)=>e.wins>t.wins?1:-1))):sessionStorage.getItem("sortWins")===o.default.sorted.down?(a&&(a.textContent="WINS ↓"),d=n.sort(((e,t)=>e.wins>t.wins?-1:1))):sessionStorage.getItem("sortTime")===o.default.sorted.up?(s&&(s.textContent="BEST TIME ↑"),d=n.sort(((e,t)=>e.time>t.time?1:-1))):sessionStorage.getItem("sortTime")===o.default.sorted.down?(s&&(s.textContent="BEST TIME ↓"),d=n.sort(((e,t)=>e.time>t.time?-1:1))):d=n,d.forEach(((n,a)=>{a>=10*e&&a<10*(e+1)&&t.append(c.createWinnerBlock(n,a))}))}));const n=document.createElement("p");n.className="winPageNum pageNum",n.textContent=`page #${e+1}`;const a=c.createHeaderTitle("WINNERS"),r=c.createPrewNext();return this.container.append(a,n,t,r),this.container}}t.default=c}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=a(807),(new(a.n(e)())).run()})();